#include <stdio.h>
#include <stdlib.h>
#include "../lodepng.c"
unsigned char *image, *pixel, colors[][3]= {
      {  0x00, 0x00, 0x00},
      {  0x00, 0x00, 0x55},
      {  0x00, 0x00, 0xaa},
      {  0x00, 0x00, 0xff},
      {  0x00, 0x24, 0x00},
      {  0x00, 0x24, 0x55},
      {  0x00, 0x24, 0xaa},
      {  0x00, 0x24, 0xff},
      {  0x00, 0x49, 0x00},
      {  0x00, 0x49, 0x55},
      {  0x00, 0x49, 0xaa},
      {  0x00, 0x49, 0xff},
      {  0x00, 0x6d, 0x00},
      {  0x00, 0x6d, 0x55},
      {  0x00, 0x6d, 0xaa},
      {  0x00, 0x6d, 0xff},
      {  0x00, 0x92, 0x00},
      {  0x00, 0x92, 0x55},
      {  0x00, 0x92, 0xaa},
      {  0x00, 0x92, 0xff},
      {  0x00, 0xb6, 0x00},
      {  0x00, 0xb6, 0x55},
      {  0x00, 0xb6, 0xaa},
      {  0x00, 0xb6, 0xff},
      {  0x00, 0xdb, 0x00},
      {  0x00, 0xdb, 0x55},
      {  0x00, 0xdb, 0xaa},
      {  0x00, 0xdb, 0xff},
      {  0x00, 0xff, 0x00},
      {  0x00, 0xff, 0x55},
      {  0x00, 0xff, 0xaa},
      {  0x00, 0xff, 0xff},
      {  0x24, 0x00, 0x00},
      {  0x24, 0x00, 0x55},
      {  0x24, 0x00, 0xaa},
      {  0x24, 0x00, 0xff},
      {  0x24, 0x24, 0x00},
      {  0x24, 0x24, 0x55},
      {  0x24, 0x24, 0xaa},
      {  0x24, 0x24, 0xff},
      {  0x24, 0x49, 0x00},
      {  0x24, 0x49, 0x55},
      {  0x24, 0x49, 0xaa},
      {  0x24, 0x49, 0xff},
      {  0x24, 0x6d, 0x00},
      {  0x24, 0x6d, 0x55},
      {  0x24, 0x6d, 0xaa},
      {  0x24, 0x6d, 0xff},
      {  0x24, 0x92, 0x00},
      {  0x24, 0x92, 0x55},
      {  0x24, 0x92, 0xaa},
      {  0x24, 0x92, 0xff},
      {  0x24, 0xb6, 0x00},
      {  0x24, 0xb6, 0x55},
      {  0x24, 0xb6, 0xaa},
      {  0x24, 0xb6, 0xff},
      {  0x24, 0xdb, 0x00},
      {  0x24, 0xdb, 0x55},
      {  0x24, 0xdb, 0xaa},
      {  0x24, 0xdb, 0xff},
      {  0x24, 0xff, 0x00},
      {  0x24, 0xff, 0x55},
      {  0x24, 0xff, 0xaa},
      {  0x24, 0xff, 0xff},
      {  0x49, 0x00, 0x00},
      {  0x49, 0x00, 0x55},
      {  0x49, 0x00, 0xaa},
      {  0x49, 0x00, 0xff},
      {  0x49, 0x24, 0x00},
      {  0x49, 0x24, 0x55},
      {  0x49, 0x24, 0xaa},
      {  0x49, 0x24, 0xff},
      {  0x49, 0x49, 0x00},
      {  0x49, 0x49, 0x55},
      {  0x49, 0x49, 0xaa},
      {  0x49, 0x49, 0xff},
      {  0x49, 0x6d, 0x00},
      {  0x49, 0x6d, 0x55},
      {  0x49, 0x6d, 0xaa},
      {  0x49, 0x6d, 0xff},
      {  0x49, 0x92, 0x00},
      {  0x49, 0x92, 0x55},
      {  0x49, 0x92, 0xaa},
      {  0x49, 0x92, 0xff},
      {  0x49, 0xb6, 0x00},
      {  0x49, 0xb6, 0x55},
      {  0x49, 0xb6, 0xaa},
      {  0x49, 0xb6, 0xff},
      {  0x49, 0xdb, 0x00},
      {  0x49, 0xdb, 0x55},
      {  0x49, 0xdb, 0xaa},
      {  0x49, 0xdb, 0xff},
      {  0x49, 0xff, 0x00},
      {  0x49, 0xff, 0x55},
      {  0x49, 0xff, 0xaa},
      {  0x49, 0xff, 0xff},
      {  0x6d, 0x00, 0x00},
      {  0x6d, 0x00, 0x55},
      {  0x6d, 0x00, 0xaa},
      {  0x6d, 0x00, 0xff},
      {  0x6d, 0x24, 0x00},
      {  0x6d, 0x24, 0x55},
      {  0x6d, 0x24, 0xaa},
      {  0x6d, 0x24, 0xff},
      {  0x6d, 0x49, 0x00},
      {  0x6d, 0x49, 0x55},
      {  0x6d, 0x49, 0xaa},
      {  0x6d, 0x49, 0xff},
      {  0x6d, 0x6d, 0x00},
      {  0x6d, 0x6d, 0x55},
      {  0x6d, 0x6d, 0xaa},
      {  0x6d, 0x6d, 0xff},
      {  0x6d, 0x92, 0x00},
      {  0x6d, 0x92, 0x55},
      {  0x6d, 0x92, 0xaa},
      {  0x6d, 0x92, 0xff},
      {  0x6d, 0xb6, 0x00},
      {  0x6d, 0xb6, 0x55},
      {  0x6d, 0xb6, 0xaa},
      {  0x6d, 0xb6, 0xff},
      {  0x6d, 0xdb, 0x00},
      {  0x6d, 0xdb, 0x55},
      {  0x6d, 0xdb, 0xaa},
      {  0x6d, 0xdb, 0xff},
      {  0x6d, 0xff, 0x00},
      {  0x6d, 0xff, 0x55},
      {  0x6d, 0xff, 0xaa},
      {  0x6d, 0xff, 0xff},
      {  0x92, 0x00, 0x00},
      {  0x92, 0x00, 0x55},
      {  0x92, 0x00, 0xaa},
      {  0x92, 0x00, 0xff},
      {  0x92, 0x24, 0x00},
      {  0x92, 0x24, 0x55},
      {  0x92, 0x24, 0xaa},
      {  0x92, 0x24, 0xff},
      {  0x92, 0x49, 0x00},
      {  0x92, 0x49, 0x55},
      {  0x92, 0x49, 0xaa},
      {  0x92, 0x49, 0xff},
      {  0x92, 0x6d, 0x00},
      {  0x92, 0x6d, 0x55},
      {  0x92, 0x6d, 0xaa},
      {  0x92, 0x6d, 0xff},
      {  0x92, 0x92, 0x00},
      {  0x92, 0x92, 0x55},
      {  0x92, 0x92, 0xaa},
      {  0x92, 0x92, 0xff},
      {  0x92, 0xb6, 0x00},
      {  0x92, 0xb6, 0x55},
      {  0x92, 0xb6, 0xaa},
      {  0x92, 0xb6, 0xff},
      {  0x92, 0xdb, 0x00},
      {  0x92, 0xdb, 0x55},
      {  0x92, 0xdb, 0xaa},
      {  0x92, 0xdb, 0xff},
      {  0x92, 0xff, 0x00},
      {  0x92, 0xff, 0x55},
      {  0x92, 0xff, 0xaa},
      {  0x92, 0xff, 0xff},
      {  0xb6, 0x00, 0x00},
      {  0xb6, 0x00, 0x55},
      {  0xb6, 0x00, 0xaa},
      {  0xb6, 0x00, 0xff},
      {  0xb6, 0x24, 0x00},
      {  0xb6, 0x24, 0x55},
      {  0xb6, 0x24, 0xaa},
      {  0xb6, 0x24, 0xff},
      {  0xb6, 0x49, 0x00},
      {  0xb6, 0x49, 0x55},
      {  0xb6, 0x49, 0xaa},
      {  0xb6, 0x49, 0xff},
      {  0xb6, 0x6d, 0x00},
      {  0xb6, 0x6d, 0x55},
      {  0xb6, 0x6d, 0xaa},
      {  0xb6, 0x6d, 0xff},
      {  0xb6, 0x92, 0x00},
      {  0xb6, 0x92, 0x55},
      {  0xb6, 0x92, 0xaa},
      {  0xb6, 0x92, 0xff},
      {  0xb6, 0xb6, 0x00},
      {  0xb6, 0xb6, 0x55},
      {  0xb6, 0xb6, 0xaa},
      {  0xb6, 0xb6, 0xff},
      {  0xb6, 0xdb, 0x00},
      {  0xb6, 0xdb, 0x55},
      {  0xb6, 0xdb, 0xaa},
      {  0xb6, 0xdb, 0xff},
      {  0xb6, 0xff, 0x00},
      {  0xb6, 0xff, 0x55},
      {  0xb6, 0xff, 0xaa},
      {  0xb6, 0xff, 0xff},
      {  0xdb, 0x00, 0x00},
      {  0xdb, 0x00, 0x55},
      {  0xdb, 0x00, 0xaa},
      {  0xdb, 0x00, 0xff},
      {  0xdb, 0x24, 0x00},
      {  0xdb, 0x24, 0x55},
      {  0xdb, 0x24, 0xaa},
      {  0xdb, 0x24, 0xff},
      {  0xdb, 0x49, 0x00},
      {  0xdb, 0x49, 0x55},
      {  0xdb, 0x49, 0xaa},
      {  0xdb, 0x49, 0xff},
      {  0xdb, 0x6d, 0x00},
      {  0xdb, 0x6d, 0x55},
      {  0xdb, 0x6d, 0xaa},
      {  0xdb, 0x6d, 0xff},
      {  0xdb, 0x92, 0x00},
      {  0xdb, 0x92, 0x55},
      {  0xdb, 0x92, 0xaa},
      {  0xdb, 0x92, 0xff},
      {  0xdb, 0xb6, 0x00},
      {  0xdb, 0xb6, 0x55},
      {  0xdb, 0xb6, 0xaa},
      {  0xdb, 0xb6, 0xff},
      {  0xdb, 0xdb, 0x00},
      {  0xdb, 0xdb, 0x55},
      {  0xdb, 0xdb, 0xaa},
      {  0xdb, 0xdb, 0xff},
      {  0xdb, 0xff, 0x00},
      {  0xdb, 0xff, 0x55},
      {  0xdb, 0xff, 0xaa},
      {  0xdb, 0xff, 0xff},
      {  0xff, 0x00, 0x00},
      {  0xff, 0x00, 0x55},
      {  0xff, 0x00, 0xaa},
      {  0xff, 0x00, 0xff},
      {  0xff, 0x24, 0x00},
      {  0xff, 0x24, 0x55},
      {  0xff, 0x24, 0xaa},
      {  0xff, 0x24, 0xff},
      {  0xff, 0x49, 0x00},
      {  0xff, 0x49, 0x55},
      {  0xff, 0x49, 0xaa},
      {  0xff, 0x49, 0xff},
      {  0xff, 0x6d, 0x00},
      {  0xff, 0x6d, 0x55},
      {  0xff, 0x6d, 0xaa},
      {  0xff, 0x6d, 0xff},
      {  0xff, 0x92, 0x00},
      {  0xff, 0x92, 0x55},
      {  0xff, 0x92, 0xaa},
      {  0xff, 0x92, 0xff},
      {  0xff, 0xb6, 0x00},
      {  0xff, 0xb6, 0x55},
      {  0xff, 0xb6, 0xaa},
      {  0xff, 0xb6, 0xff},
      {  0xff, 0xdb, 0x00},
      {  0xff, 0xdb, 0x55},
      {  0xff, 0xdb, 0xaa},
      {  0xff, 0xdb, 0xff},
      {  0xff, 0xff, 0x00},
      {  0xff, 0xff, 0x55},
      {  0xff, 0xff, 0xaa},
      {  0xff, 0xff, 0xff}};
unsigned error, width, height, i, calc, min, minind, size;
int main(int argc, char *argv[]){
  if( argc==1 )
    printf("\nPosterizeRadastan v1.00. Transform any image to ZX-Uno Radastan mode\n"
           "                                        by AntonioVillena, 29 Jun 2016\n\n"
           "  PosterizeRadastan <input_file> <output_file>\n\n"
           "  <input_file>      PNG input file\n"
           "  <output_file>     PNG output file\n\n"
           "Example: PosterizeRadastan work.png tiles.png\n"),
    exit(0);
  if( argc!=3 )
    printf("\nInvalid number of parameters\n"),
    exit(-1);
  if( error= lodepng_decode32_file(&image, &width, &height, argv[1]) )
    printf("\nError %u: %s\n", error, lodepng_error_text(error)),
    exit(-1);
  size= width*height;
  pixel= image;
  while ( size-- ){
    min= 1e9;
    for ( i= 0; i<255; i++ ){
      calc= (pixel[0]-colors[i][0])*(pixel[0]-colors[i][0])
          + (pixel[1]-colors[i][1])*(pixel[1]-colors[i][1])
          + (pixel[2]-colors[i][2])*(pixel[2]-colors[i][2]);
      if( calc<min )
        min= calc,
        minind= i;
    }
    pixel[0]= colors[minind][0];
    pixel[1]= colors[minind][1];
    pixel[2]= colors[minind][2];
    pixel+= 4;
  }
  if( error= lodepng_encode32_file(argv[2], image, width, height) )
    printf("Error %u: %s\n", error, lodepng_error_text(error)),
    exit(-1);
  free(image);
  printf("\nFile posterized successfully\n");
}
